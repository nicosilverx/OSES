<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Erika3 Manual: Application modes, Startup and Shutdown primitives</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="erika3.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Erika3 Manual
   &#160;<span id="projectnumber">GH55</span>
   </div>
   <div id="projectbrief">a tiny RTOS for small microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__primitives-startup.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Application modes, Startup and Shutdown primitives</div>  </div>
</div><!--header-->
<div class="contents">

<p>ERIKA3 supports the specification of a set of <em>Application Modes</em>. Application modes are startup configurations that are used to configure the running application for a certain mode of operation. Examples of Application Modes are for example <em>Normal execution</em>, <em>Flash Programming</em>, <em>Debug Mode</em>, and so on.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga3868411e6ffc06ead1ed235231e3f349"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-startup.html#ga3868411e6ffc06ead1ed235231e3f349">INVALID_APPMODE</a>&#160;&#160;&#160;((<a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a>)-1)</td></tr>
<tr class="memdesc:ga3868411e6ffc06ead1ed235231e3f349"><td class="mdescLeft">&#160;</td><td class="mdescRight">Value for invalid application modes.  <a href="group__primitives-startup.html#ga3868411e6ffc06ead1ed235231e3f349">More...</a><br /></td></tr>
<tr class="separator:ga3868411e6ffc06ead1ed235231e3f349"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab74c84d2ad642900d7b9233a141137b0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-startup.html#gab74c84d2ad642900d7b9233a141137b0">OSDEFAULTAPPMODE</a>&#160;&#160;&#160;((<a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a>)0U)</td></tr>
<tr class="memdesc:gab74c84d2ad642900d7b9233a141137b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default Application Mode.  <a href="group__primitives-startup.html#gab74c84d2ad642900d7b9233a141137b0">More...</a><br /></td></tr>
<tr class="separator:gab74c84d2ad642900d7b9233a141137b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga087544142e97a6460c6a189f2ffca569"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-startup.html#ga087544142e97a6460c6a189f2ffca569">DONOTCARE</a>&#160;&#160;&#160;((<a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a>)-1)</td></tr>
<tr class="memdesc:ga087544142e97a6460c6a189f2ffca569"><td class="mdescLeft">&#160;</td><td class="mdescRight">Do Not Care Application Mode.  <a href="group__primitives-startup.html#ga087544142e97a6460c6a189f2ffca569">More...</a><br /></td></tr>
<tr class="separator:ga087544142e97a6460c6a189f2ffca569"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gae3e1ae7b5a088e40194d7b5dc48db693"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="ee__api__types_8h.html#a9cfad4540e6c5c90f3957a4d989a0744">OSEE_APPMODE_TYPE</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a></td></tr>
<tr class="memdesc:gae3e1ae7b5a088e40194d7b5dc48db693"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type used for application modes.  <a href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">More...</a><br /></td></tr>
<tr class="separator:gae3e1ae7b5a088e40194d7b5dc48db693"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga5fb8a3c5837da7854c4da9972cefda96"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96">StartOS</a> (<a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a> Mode)</td></tr>
<tr class="memdesc:ga5fb8a3c5837da7854c4da9972cefda96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Operating system startup routine.  <a href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96">More...</a><br /></td></tr>
<tr class="separator:ga5fb8a3c5837da7854c4da9972cefda96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6df6f7c4e5965c72bd089c9f381f6ef2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-startup.html#ga6df6f7c4e5965c72bd089c9f381f6ef2">ShutdownOS</a> (<a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a> Error)</td></tr>
<tr class="memdesc:ga6df6f7c4e5965c72bd089c9f381f6ef2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Abort the overall system.  <a href="group__primitives-startup.html#ga6df6f7c4e5965c72bd089c9f381f6ef2">More...</a><br /></td></tr>
<tr class="separator:ga6df6f7c4e5965c72bd089c9f381f6ef2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabc0f6f367be3f334998dcd73da2a2dbb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-startup.html#gabc0f6f367be3f334998dcd73da2a2dbb">GetActiveApplicationMode</a> (void)</td></tr>
<tr class="memdesc:gabc0f6f367be3f334998dcd73da2a2dbb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the current application mode.  <a href="group__primitives-startup.html#gabc0f6f367be3f334998dcd73da2a2dbb">More...</a><br /></td></tr>
<tr class="separator:gabc0f6f367be3f334998dcd73da2a2dbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The main idea is that the CPU startup code somehow discovers the current Application mode (Typical ways to discover Application Modes are for example the usage of dip switches on the device board). Once done that, the application mode is passed to <a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96" title="Operating system startup routine.">StartOS()</a>, that sets the application mode for this run. Once the system is started, the application mode value can be read using a call to <a class="el" href="group__primitives-startup.html#gabc0f6f367be3f334998dcd73da2a2dbb" title="Reads the current application mode.">GetActiveApplicationMode()</a>.</p>
<p>Application modes are listed inside the OIL configuration file. There always exist at least one application mode called OSDEFAULTAPPMODE. Once set at startup into <a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96" title="Operating system startup routine.">StartOS()</a>, the Application mode cannot be changed.</p>
<p>Application modes are also useful to autostart tasks and alarms following a call to <a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96" title="Operating system startup routine.">StartOS()</a>. Tasks and alarms autostart features must be specified inside the OIL configuration file.</p>
<p>Application modes should not be used to map application states that may vary during the application execution.</p>
<p>The primitive <a class="el" href="group__primitives-startup.html#ga6df6f7c4e5965c72bd089c9f381f6ef2" title="Abort the overall system.">ShutdownOS()</a> is used to prepare the system for system shutdown. The function simply calls <a class="el" href="group__primitives-hook.html#ga0aa20efaae2d6dfc08579cc92576a890" title="Hook called inside ShutdownOS().">ShutdownHook()</a> and then it starts a forever loop waiting for an hardware reset.</p>
<p>On multicore systems, the <a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96" title="Operating system startup routine.">StartOS()</a> and <a class="el" href="group__primitives-startup.html#ga6df6f7c4e5965c72bd089c9f381f6ef2" title="Abort the overall system.">ShutdownOS()</a> are implemented respecting the AUTOSAR specifications, in particular related to the usage of barriers to synchronize the cores startup/shutdown. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga087544142e97a6460c6a189f2ffca569"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga087544142e97a6460c6a189f2ffca569">&#9670;&nbsp;</a></span>DONOTCARE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DONOTCARE&#160;&#160;&#160;((<a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a>)-1)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Do Not Care Application Mode. Inherits the startup mode from other cores.</p>
<p>Reference: AUTOSAR OS - [SWS_Os_91007] </p>

</div>
</div>
<a id="ga3868411e6ffc06ead1ed235231e3f349"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3868411e6ffc06ead1ed235231e3f349">&#9670;&nbsp;</a></span>INVALID_APPMODE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INVALID_APPMODE&#160;&#160;&#160;((<a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a>)-1)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Value for invalid application modes. No application mode will have this value. </p>

</div>
</div>
<a id="gab74c84d2ad642900d7b9233a141137b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab74c84d2ad642900d7b9233a141137b0">&#9670;&nbsp;</a></span>OSDEFAULTAPPMODE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSDEFAULTAPPMODE&#160;&#160;&#160;((<a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a>)0U)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default Application Mode. Always a valid parameter for <a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96" title="Operating system startup routine.">StartOS()</a></p>
<p>Reference: OSEK OS - ISO 17356-3 - 13.8.3 </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="gae3e1ae7b5a088e40194d7b5dc48db693"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae3e1ae7b5a088e40194d7b5dc48db693">&#9670;&nbsp;</a></span>AppModeType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="ee__api__types_8h.html#a9cfad4540e6c5c90f3957a4d989a0744">OSEE_APPMODE_TYPE</a> <a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is the type that stores Application modes. It is an integer value. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gabc0f6f367be3f334998dcd73da2a2dbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabc0f6f367be3f334998dcd73da2a2dbb">&#9670;&nbsp;</a></span>GetActiveApplicationMode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a> GetActiveApplicationMode </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The function returns the current Application Mode, that has been set up by <a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96" title="Operating system startup routine.">StartOS()</a> at system startup.</p>
<p>Conformance Classes: BCC1, BCC2, ECC1, ECC2</p>
<p>Reference: OSEK OS - ISO 17356-3 - 13.8.2.1</p>
<dl class="section return"><dt>Returns</dt><dd>The function returns the current application mode. </dd></dl>

</div>
</div>
<a id="ga6df6f7c4e5965c72bd089c9f381f6ef2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6df6f7c4e5965c72bd089c9f381f6ef2">&#9670;&nbsp;</a></span>ShutdownOS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a> ShutdownOS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a>&#160;</td>
          <td class="paramname"><em>Error</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The user can call this system service to abort the overall system (e.g. emergency off).</p>
<p>If a <a class="el" href="group__primitives-hook.html#ga0aa20efaae2d6dfc08579cc92576a890" title="Hook called inside ShutdownOS().">ShutdownHook()</a> is configured the hook routine <a class="el" href="group__primitives-hook.html#ga0aa20efaae2d6dfc08579cc92576a890" title="Hook called inside ShutdownOS().">ShutdownHook()</a> is always called (with <em>Error</em> as argument) before shutting down the operating system.</p>
<p>The Operating system shutdown is currently implemented as a forever loop with interrupt disabled.</p>
<p>In case of multicore devices, the ShutdownHook takes care of multicore synchronization and multicore shutdown as specified by the AUTOSAR OS standard.</p>
<p>Conformance Classes: BCC1, BCC2, ECC1, ECC2</p>
<p>Reference: OSEK OS - ISO 17356-3 - 13.8.2.3</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Error</td><td>The identifier of the error which occurred. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function does not return. </dd></dl>

</div>
</div>
<a id="ga5fb8a3c5837da7854c4da9972cefda96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5fb8a3c5837da7854c4da9972cefda96">&#9670;&nbsp;</a></span>StartOS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a> StartOS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__primitives-startup.html#gae3e1ae7b5a088e40194d7b5dc48db693">AppModeType</a>&#160;</td>
          <td class="paramname"><em>Mode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The user can call this system service to start the operating system in a specific Application mode. Only allowed outside of the operating system, at startup. The function calls in order the <a class="el" href="group__primitives-hook.html#ga5cb66285b5a4c562ec9c47bd9f7eb2b6" title="Called inside StartOS().">StartupHook()</a>, then it activates the tasks and set the alarms <em>AUTOSTART</em> set as <em>TRUE</em> inside the OIL configuration file. After that, the system is rescheduled and the highest priority ready task is executed.</p>
<p>The <a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96" title="Operating system startup routine.">StartOS()</a> primitive by default never returns to the caller.</p>
<p>If specified in the OIL file, the idle loop hook will be called inside the <a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96" title="Operating system startup routine.">StartOS()</a>.</p>
<p>On multicore systems, the <a class="el" href="group__primitives-startup.html#ga5fb8a3c5837da7854c4da9972cefda96" title="Operating system startup routine.">StartOS()</a> have to be called by each core, as specified by the AUTOSAR OS standard.</p>
<p>Conformance Classes: BCC1, BCC2, ECC1, ECC2</p>
<p>Reference: OSEK OS - ISO 17356-3 - 13.8.2.2</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Mode</td><td>The startup application mode. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns a StatusType.<ul>
<li>E_OK (Extended) No error.</li>
<li>E_OS_SYS_INIT (Extended) Error during initialization. </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
