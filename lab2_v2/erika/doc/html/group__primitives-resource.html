<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Erika3 Manual: Resource Primitives</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="erika3.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Erika3 Manual
   &#160;<span id="projectnumber">GH55</span>
   </div>
   <div id="projectbrief">a tiny RTOS for small microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__primitives-resource.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Resource Primitives</div>  </div>
</div><!--header-->
<div class="contents">

<p>The Resource Primitives are related to shared resource handling in single cores.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga92783ef01a97745e1f4a6696cb889d86"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-resource.html#ga92783ef01a97745e1f4a6696cb889d86">INVALID_RESOURCE</a>&#160;&#160;&#160;((<a class="el" href="group__primitives-resource.html#gaac3971a971a95d78051b389553842386">ResourceType</a>)-1)</td></tr>
<tr class="memdesc:ga92783ef01a97745e1f4a6696cb889d86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invalid resource ID.  <a href="group__primitives-resource.html#ga92783ef01a97745e1f4a6696cb889d86">More...</a><br /></td></tr>
<tr class="separator:ga92783ef01a97745e1f4a6696cb889d86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga286e6fb0ad7ab110ca50a94305981769"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-resource.html#ga286e6fb0ad7ab110ca50a94305981769">DeclareResource</a>(Res)</td></tr>
<tr class="memdesc:ga286e6fb0ad7ab110ca50a94305981769"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resource Declaration.  <a href="group__primitives-resource.html#ga286e6fb0ad7ab110ca50a94305981769">More...</a><br /></td></tr>
<tr class="separator:ga286e6fb0ad7ab110ca50a94305981769"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gaac3971a971a95d78051b389553842386"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="ee__api__types_8h.html#a7b62a74d3f3436ea0f46d9f0906a5844">OSEE_RESOURCE_ID_TYPE</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-resource.html#gaac3971a971a95d78051b389553842386">ResourceType</a></td></tr>
<tr class="memdesc:gaac3971a971a95d78051b389553842386"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for Resource IDs.  <a href="group__primitives-resource.html#gaac3971a971a95d78051b389553842386">More...</a><br /></td></tr>
<tr class="separator:gaac3971a971a95d78051b389553842386"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaece92730f23a01b1dc858668f7d3b18b"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="ee__api__types_8h.html#a7bfbe7391e1694cc2f73243016b92fbf">OSEE_SCHEDULETABLE_TYPE</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-resource.html#gaece92730f23a01b1dc858668f7d3b18b">ScheduleTableType</a></td></tr>
<tr class="memdesc:gaece92730f23a01b1dc858668f7d3b18b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for Schedule Tables.  <a href="group__primitives-resource.html#gaece92730f23a01b1dc858668f7d3b18b">More...</a><br /></td></tr>
<tr class="separator:gaece92730f23a01b1dc858668f7d3b18b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga46ad16cac20fafd01dedd9d5ff8adc8c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-resource.html#ga46ad16cac20fafd01dedd9d5ff8adc8c">GetResource</a> (<a class="el" href="group__primitives-resource.html#gaac3971a971a95d78051b389553842386">ResourceType</a> ResID)</td></tr>
<tr class="memdesc:ga46ad16cac20fafd01dedd9d5ff8adc8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locks a shared resource.  <a href="group__primitives-resource.html#ga46ad16cac20fafd01dedd9d5ff8adc8c">More...</a><br /></td></tr>
<tr class="separator:ga46ad16cac20fafd01dedd9d5ff8adc8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa64c380bffc916eb1ba070524cd92584"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__primitives-resource.html#gaa64c380bffc916eb1ba070524cd92584">ReleaseResource</a> (<a class="el" href="group__primitives-resource.html#gaac3971a971a95d78051b389553842386">ResourceType</a> ResID)</td></tr>
<tr class="memdesc:gaa64c380bffc916eb1ba070524cd92584"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases a resource previously locked with GetResource.  <a href="group__primitives-resource.html#gaa64c380bffc916eb1ba070524cd92584">More...</a><br /></td></tr>
<tr class="separator:gaa64c380bffc916eb1ba070524cd92584"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Resources are the term used by ERIKA3 to refer to binary semaphores used to implement shared critical sections.</p>
<p>Resources are implemented using the Immediate Priority Ceiling protocol.</p>
<p>A resource is locked using the primitive <a class="el" href="group__primitives-resource.html#ga46ad16cac20fafd01dedd9d5ff8adc8c" title="Locks a shared resource.">GetResource()</a>, and unlocked using <a class="el" href="group__primitives-resource.html#gaa64c380bffc916eb1ba070524cd92584" title="Releases a resource previously locked with GetResource.">ReleaseResource()</a>.</p>
<p>A special resource named RES_SCHEDULER is also supported. The RES_SCHEDULER resource has a ceiling equal to the highest priority in the system. As a result, a task locking RES_SCHEDULER becomes non-preemptive. If needed, the RES_SCHEDULER resource have to be configured in the OIL configuration file.</p>
<p>On multiprocessor systems, Resources are divided in:</p><ul>
<li><em>Local resources</em> A Resource is local when all the tasks that uses it are assigned to the same processor. In this case you should use a Resource to implement the mutual exclusion.</li>
<li><em>Global resources</em> A Resource is global when the tasks that uses it are assigned to different processors. In this case you should use a Spin Lock to implement the mutual exclusion.</li>
</ul>
<p>A special kind of resources, called <em>Internal Resources</em>, are also supported by ERIKA3. Internal Resources are locked when the tasks enter the RUNNING state, and it is released when the task ends. Internal resources are used by optimization algorithms to limit the maximum stack space used by application tasks. Please note that <a class="el" href="group__primitives-task.html#gab4c3463247a1aa258800f903b0a52a9d" title="A rescheduling point typically used in non-preemptive tasks.">Schedule()</a> explicitly release any Internal Resource locked by the running task, thus limiting the possibility to reduce the overall stack in the system. Also <a class="el" href="group__primitives-event.html#gaefbe4d95d1e197c7bbecdb12dab07097" title="The calling task waits for one of the events in the Mask.">WaitEvent()</a> always release the internal resource of the task; however, this fact does not impact on stack usage because tasks using <a class="el" href="group__primitives-event.html#gaefbe4d95d1e197c7bbecdb12dab07097" title="The calling task waits for one of the events in the Mask.">WaitEvent()</a> must run on a private stack since <a class="el" href="group__primitives-event.html#gaefbe4d95d1e197c7bbecdb12dab07097" title="The calling task waits for one of the events in the Mask.">WaitEvent()</a> is a blocking primitive. Please also note that on Multicore systems, Internal Resources can only be <em>local</em>. Global Internal Resources are not supported.</p>
<p>ERIKA3 supports resource management at ISR level for a selected number of architectures. Please check on the ERIKA3 wiki whether the architecture you are currently using supports this feature. The implementation of this feature is implemented extending the OIL configuration to accept ISR priority as extra field in ISR Object definition. The ISR Priority field contains architecture independent values which are then mapped by RT-Druid to Task and Interrupt Controller priority values. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga286e6fb0ad7ab110ca50a94305981769"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga286e6fb0ad7ab110ca50a94305981769">&#9670;&nbsp;</a></span>DeclareResource</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DeclareResource</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">Res</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Declares a resource used by Tasks.</p>
<p>This declaration is currently not mandatory because resource identifiers are all declared within the code generated by RT-Druid.</p>
<p>Reference: OSEK OS - ISO 17356-3 - 13.5.2.1</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Res</td><td>The resource to be declared. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="ga92783ef01a97745e1f4a6696cb889d86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga92783ef01a97745e1f4a6696cb889d86">&#9670;&nbsp;</a></span>INVALID_RESOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INVALID_RESOURCE&#160;&#160;&#160;((<a class="el" href="group__primitives-resource.html#gaac3971a971a95d78051b389553842386">ResourceType</a>)-1)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A constant representing an invalid Resource. </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="gaac3971a971a95d78051b389553842386"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaac3971a971a95d78051b389553842386">&#9670;&nbsp;</a></span>ResourceType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="ee__api__types_8h.html#a7b62a74d3f3436ea0f46d9f0906a5844">OSEE_RESOURCE_ID_TYPE</a> <a class="el" href="group__primitives-resource.html#gaac3971a971a95d78051b389553842386">ResourceType</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Type used to store a Resource ID. </p>

</div>
</div>
<a id="gaece92730f23a01b1dc858668f7d3b18b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaece92730f23a01b1dc858668f7d3b18b">&#9670;&nbsp;</a></span>ScheduleTableType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="ee__api__types_8h.html#a7bfbe7391e1694cc2f73243016b92fbf">OSEE_SCHEDULETABLE_TYPE</a> <a class="el" href="group__primitives-resource.html#gaece92730f23a01b1dc858668f7d3b18b">ScheduleTableType</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Type used to store a Schedule Table. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga46ad16cac20fafd01dedd9d5ff8adc8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga46ad16cac20fafd01dedd9d5ff8adc8c">&#9670;&nbsp;</a></span>GetResource()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a> GetResource </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__primitives-resource.html#gaac3971a971a95d78051b389553842386">ResourceType</a>&#160;</td>
          <td class="paramname"><em>ResID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This primitive can be used to implement a critical section guarded by Resource ResID. The critical section will end with the call to <a class="el" href="group__primitives-resource.html#gaa64c380bffc916eb1ba070524cd92584" title="Releases a resource previously locked with GetResource.">ReleaseResource()</a>.</p>
<p>Nesting between critical sections guarded by different resources is allowed.</p>
<p>Calls to <a class="el" href="group__primitives-task.html#ga83c21cbaa47c5ac5cd56b7ba6490b8ca" title="Terminates the calling task.">TerminateTask()</a>, <a class="el" href="group__primitives-task.html#ga89ce30708e79048336a17c62bb47e1c7" title="Terminates the calling task, and atomically activates the TaskID passed as parameter.">ChainTask()</a>, <a class="el" href="group__primitives-task.html#gab4c3463247a1aa258800f903b0a52a9d" title="A rescheduling point typically used in non-preemptive tasks.">Schedule()</a>, and <a class="el" href="group__primitives-event.html#gaefbe4d95d1e197c7bbecdb12dab07097" title="The calling task waits for one of the events in the Mask.">WaitEvent()</a> are not allowed inside the critical section.</p>
<p>Resources may be called on ISR level as well (see ISO17356-3 8.7).</p>
<p>Conformance Classes: BCC1, BCC2, ECC1, ECC2</p>
<p>Reference: OSEK OS - ISO 17356-3 - 13.5.3.1</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ResID</td><td>The resource to lock. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns a StatusType.<ul>
<li>E_OK No error.</li>
<li>E_OS_ID (Extended) Resource ResID is invalid.</li>
<li>E_OS_ACCESS (Extended) Attempt to get a resource which is already occupied by any task or ISR, or the statically assigned priority of the calling task or interrupt routine is higher than the calculated ceiling priority. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="gaa64c380bffc916eb1ba070524cd92584"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa64c380bffc916eb1ba070524cd92584">&#9670;&nbsp;</a></span>ReleaseResource()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ee__api__types_8h.html#a79bf54a17078edb124b553c51129396a">StatusType</a> ReleaseResource </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__primitives-resource.html#gaac3971a971a95d78051b389553842386">ResourceType</a>&#160;</td>
          <td class="paramname"><em>ResID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="group__primitives-resource.html#gaa64c380bffc916eb1ba070524cd92584" title="Releases a resource previously locked with GetResource.">ReleaseResource()</a> is used to release a resource locked using <a class="el" href="group__primitives-resource.html#ga46ad16cac20fafd01dedd9d5ff8adc8c" title="Locks a shared resource.">GetResource()</a>, closing a critical section.</p>
<p>For information on nested critical sections, see <a class="el" href="group__primitives-resource.html#ga46ad16cac20fafd01dedd9d5ff8adc8c" title="Locks a shared resource.">GetResource()</a>. The service may be called from an ISR and from task level.</p>
<p>Conformance Classes: BCC1, BCC2, ECC1, ECC2</p>
<p>Reference: OSEK OS - ISO 17356-3 - 13.5.3.2</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ResID</td><td>The resource to lock. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns a StatusType.<ul>
<li>E_OK No error</li>
<li>E_OS_ID (Extended) ResID is an invalid identifier</li>
<li>E_OS_NOFUNC (Extended) Attempt to release a resource which is not occupied by any task or ISR, or another resource shall be released before.</li>
<li>E_OS_ACCESS (Extended) Attempt to release a resource which has a lower ceiling priority than the statically assigned priority of the calling task or interrupt routine. </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
